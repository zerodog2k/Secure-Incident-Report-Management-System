{% extends "base.html" %}
{% block content %}
<div class="card border-0 shadow-sm">
  <div class="card-body p-4">
    <h4 class="mb-3">Edit Incident #{{ incident.id }}</h4>

    <form method="post" action="{{ url_for('incident_edit_post', incident_id=incident.id) }}">
      <div class="mb-3">
        <label class="form-label">Title</label>
        <input class="form-control" name="title" value="{{ incident.title }}" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Description</label>
        <textarea class="form-control" name="description" rows="5" required>{{ incident.description }}</textarea>
      </div>

      <div class="row g-2">
        <div class="col-md-3">
          <label class="form-label">Severity</label>
          <select class="form-select" name="severity">
            {% for s in ["Low","Medium","High","Critical"] %}
              <option value="{{ s }}" {% if incident.severity==s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-4">
          <label class="form-label">Category</label>
          <input class="form-control" name="category" value="{{ incident.category }}">
        </div>

        <div class="col-md-5">
          <label class="form-label">Affected asset</label>
          <input class="form-control" name="affected_asset" value="{{ incident.affected_asset or '' }}">
        </div>
      </div>

      <div class="mt-3">
        <label class="form-label">Status</label>
        <select class="form-select" name="status">
          {% for s in ["Open","In Progress","Resolved","Closed"] %}
            <option value="{{ s }}" {% if incident.status==s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>

      {% if current_user.role in ['Admin','Analyst'] %}
      <div class="mt-3">
        <label class="form-label">Assignee</label>
        <select class="form-select" name="assignee_id">
          <option value="">Unassigned</option>
          {% for u in analysts %}
            <option value="{{ u.id }}" {% if incident.assignee_id==u.id %}selected{% endif %}>{{ u.full_name }} ({{ u.role }})</option>
          {% endfor %}
        </select>
      </div>

      <hr class="my-4">
      <h5 class="mb-3">Response workflow</h5>

      <div class="mb-3">
        <label class="form-label">Containment</label>
        <textarea class="form-control" name="containment" rows="3">{{ incident.containment or '' }}</textarea>
      </div>
      <div class="mb-3">
        <label class="form-label">Eradication</label>
        <textarea class="form-control" name="eradication" rows="3">{{ incident.eradication or '' }}</textarea>
      </div>
      <div class="mb-3">
        <label class="form-label">Recovery</label>
        <textarea class="form-control" name="recovery" rows="3">{{ incident.recovery or '' }}</textarea>
      </div>
      <div class="mb-3">
        <label class="form-label">Lessons learned</label>
        <textarea class="form-control" name="lessons_learned" rows="3">{{ incident.lessons_learned or '' }}</textarea>
      </div>
      {% endif %}

      <div class="mt-4 d-flex gap-2">
        <button class="btn btn-primary">Save</button>
        <a class="btn btn-outline-secondary" href="{{ url_for('incident_view', incident_id=incident.id) }}">Cancel</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}
